{% extends 'FoodAppBundle::layout.html.twig' %}

{% block title %}{% trans %}general.places{% endtrans %} | {{ page_title }}{% endblock %}

{% block adnet_retargeting %}
    <!-- Adform Tracking Code BEGIN -->
    <script type="text/javascript">
        var _adftrack = {
            pm: 314127,
            divider: encodeURIComponent('|'),
            pagename: encodeURIComponent('Foodout.lt|{% trans %}general.places{% endtrans %}')
        };
        (function () { var s = document.createElement('script'); s.type = 'text/javascript'; s.async = true; s.src = 'https://track.adform.net/serving/scripts/trackpoint/async/'; var x = document.getElementsByTagName('script')[0]; x.parentNode.insertBefore(s, x); })();

    </script>
    <noscript>
        <p style="margin:0;padding:0;border:0;">
            <img src="https://track.adform.net/Serving/TrackPoint/?pm=314127&ADFPageName=Foodout.lt|{% trans %}general.places{% endtrans %}&ADFdivider=|" width="1" height="1" alt="" />
        </p>
    </noscript>
    <!-- Adform Tracking Code END -->
{% endblock %}

{% block jscode %}
    $(document).ready(function() {
        $(".content-lefter").on('ifChecked', '.filters-list input', function(event) {
            $(this).attr('checked', true);
            submitKitchens();
        });

        // Delivery type filter
        $(".site-block").on('click', '.restaurants-list-top-filters .delivery-type-filter a', function(event) {
            $(".site-block .restaurants-list-top-filters .delivery-type-filter a.selected").removeClass('selected');
            $(event.target).addClass('selected');
            submitKitchens();
        });

        $(".content-lefter").on('ifUnchecked', '.filters-list input', function(event) {
            $(this).attr('checked', false);
            submitKitchens();
        });

        $('.clear-filter-link').click(function() {
            $('.content-lefter input').iCheck('uncheck');
        });

        function submitKitchens() {

            var $filters = $(".filters-list input:checked");

            var params = {kitchens: '', filters: ''};
            var tmpName = "";
            var selectedKitchens = '';
            for(i = 0; i < $filters.length; i++) {
                tmpName = $($filters[i]).attr('name').replace("[]","");
                if (params[tmpName]!="") {
                    params[tmpName]+=",";
                }
                params[tmpName] += $($filters[i]).val();
                selectedKitchens += ','+$($filters[i]).val()
            }
            params['delivery_type'] = $(".site-block .restaurants-list-top-filters .delivery-type-filter a.selected").attr('data-type');
            params['recommended'] = '{{ recommended }}';

            var kitchenParams = { 'recommended': '{{ recommended }}', 'delivery_type': params['delivery_type'], 'selected_kitchens': selectedKitchens};

            $.get('{{ path('food_kitchens_filter') }}', kitchenParams, function(resp) {
                var $container = $('.content-lefter');
                $container.find('.filter-title').remove();
                $container.find('.filters-list').remove();
                $container.prepend(resp);
                $container.iCheck();
            });

            $('.content-righter').mask();
            $.post('{{ path('food_places_filter') }}', params, function(resp) {
                var $container = $('.content-righter');
                $container.find('.restaurants-list').remove();
                $container.unmask();
                $container.append(resp);

                $('.restoran-rating').raty({
                    readOnly: true,
                    score: function() {
                        return $(this).attr('data-stars');
                    },
                    path: '/bundles/foodapp/images/'
                });
            });
        }
    });
{% endblock %}
{% block body %}
    {% javascripts '@FoodAppBundle/Resources/public/scripts/fancy/jquery.fancybox.pack.js'
                   '@FoodAppBundle/Resources/public/scripts/fancy/helpers/jquery.fancybox-media.js' %}
        <script src="{{ asset_url }}"></script>
    {% endjavascripts %}

    {% stylesheets '@FoodAppBundle/Resources/public/scripts/fancy/jquery.fancybox.css' %}
        <link rel="stylesheet" href="{{ asset_url }}" type="text/css"  />
    {% endstylesheets %}

    <div class="change-location-box"></div>
    <div class="site-center">
    <div class="site-block">
    <div class="page-path clearfix">{#<a href="{{ path('food_homepage') }}">Pradžia</a>#}</div>{# TODO breadcrumbs <a href="#">Restoranai arti Žirmūnų</a>#}
    <div class="page-title">
        <h1>{% trans %}places.header_main_part{% endtrans %}{% if location and location.city %} {{ city_translations[location.city]|trans }}{% endif %}</h1>
        <h2 class="clearfix">
            <span class="place-counter"></span>
            <a href="#" id="places-change-location-link">{% trans %}places.change_address{% endtrans %}</a>
        </h2>
        {% if recommended==0 and ( location == null or (location.not_found == true and location.street_found==true)) %}
            <div class="alert alert2 alert-warning alert_not_detailed_search"><li>{% trans %}places.is_not_detailed_search{% endtrans %}</li></div>
        {% endif %}
    </div>
    {% include 'FoodPlacesBundle:Default:change_address.html.twig' with {id: 'places-change-address', hideQlu: false, usr_address: userAllAddress} %}
    <script type="text/javascript">
        // <![CDATA[
            $(document).ready(function() {
                $('#places-change-location-link').click(function() {
                    var data_callback, data_callback;

                    click_callback = function(options) {
                        if (options.response.data.success == 1) {
                            window.location = '{{ url('food_places_lt_main') }}';
                        } else {
                            options.dialog.unmask();
                            options.alert.show();

                            setTimeout(function(){
                                options.alert.hide();
                            }, 5000);
                        }
                    }

                    data_callback = function() {
                        return { city: $('.city-row select').val(),
                                 address: $('.address-row input').val() };
                    }

                    change_location($('#places-change-address'),
                                    click_callback,
                                    data_callback,
                                    '{% trans %}cart.checkout.address_change_change{% endtrans %}',
                                    '{% trans %}cart.checkout.address_change_cancel{% endtrans %}',
                                    '{{ url('food_ajax', {'action': 'find-address'}) }}');

                    return false;
                })
            });
        // ]]>
    </script>
    <div class="restaurants-list-top-filters">
        <div class="delivery-type-filter">
            <div class="label">{% trans %}places.filter_by_delivery{% endtrans %}:</div>
            <a href="#" data-type="delivery" {% if delivery_type_filer == 'delivery' or delivery_type_filer == 'delivery_and_pickup' %}class="selected"{% endif %}>{% trans %}places.filter_delivery{% endtrans %}</a>
            <a href="#" data-type="pickup" {% if delivery_type_filer == 'pickup' %}class="selected"{% endif %}>{% trans %}places.filter_pickup{% endtrans %}</a>
        </div>
    </div>
    <div class="clearfix">
        <div class="content-lefter">
            {{ render(controller('FoodDishesBundle:Kitchen:kitchenlist', {'recommended':recommended})) }}
            {{ render(controller('FoodDishesBundle:Place:filtersList')) }}

            <div class="banners">
                {% if site_country == 'LT' %}
                    <div>
                        {#<ins data-revive-zoneid="13" data-revive-id="12b88dd43b1c40010eb436263abc6451"></ins>#}
                        <script type='text/javascript'>
                            OA_show('zone1');
                        </script>
                    </div>

                    <div>
                        <script type='text/javascript'>
                            OA_show('zone2');
                        </script>
                    </div>
                    {#<div>
                        <script type='text/javascript'><!--//<![CDATA[
                            var m3_u = (location.protocol=='https:'?'https://ads.foodout.lt/delivery/ajs.php':'http://ads.foodout.lt/delivery/ajs.php');
                            var m3_r = Math.floor(Math.random()*99999999999);
                            if (!document.MAX_used) document.MAX_used = ',';
                            document.write ("<scr"+"ipt type='text/javascript' src='"+m3_u);
                            document.write ("?zoneid=15");
                            document.write ('&amp;cb=' + m3_r);
                            if (document.MAX_used != ',') document.write ("&amp;exclude=" + document.MAX_used);
                            document.write (document.charset ? '&amp;charset='+document.charset : (document.characterSet ? '&amp;charset='+document.characterSet : ''));
                            document.write ("&amp;loc=" + escape(window.location));
                            if (document.referrer) document.write ("&amp;referer=" + escape(document.referrer));
                            if (document.context) document.write ("&context=" + escape(document.context));
                            if (document.mmm_fo) document.write ("&amp;mmm_fo=1");
                            document.write ("'><\/scr"+"ipt>");
                            //]]>--></script>
                    </div>#}
                {% else %}
                    {# Revive Ads init for foodout.lt #}
                    <div>
                        <ins data-revive-zoneid="18" data-revive-id="12b88dd43b1c40010eb436263abc6451"></ins>
                    </div>

                    <div>
                        <ins data-revive-zoneid="17" data-revive-id="12b88dd43b1c40010eb436263abc6451"></ins>
                    </div>

                    <div>
                        <ins data-revive-zoneid="19" data-revive-id="12b88dd43b1c40010eb436263abc6451"></ins>
                    </div>
                    <script async src="//ads.foodout.lt/delivery/asyncjs.php"></script>
                {% endif %}
            </div>
        </div>
        <div class="content-righter">
            {#<div class="restaurants-list-controls clearfix">
                &#123;&#35;<form class="list-search-form fl">&#35;&#125;
                    &#123;&#35;<input type="text" placeholder="{% trans %}places.search_placeholder{% endtrans %}">&#35;&#125;
                    &#123;&#35;<input type="submit" value="">&#35;&#125;
                &#123;&#35;</form>&#35;&#125;
                <div class="list-top-filters clearfix fr">
                    <div class="delivery-type-filter">
                        <div class="label">{% trans %}places.filter_by_delivery{% endtrans %}:</div>
                        <a href="#" data-type="delivery_and_pickup" {% if delivery_type_filer == 'delivery_and_pickup' %}class="selected"{% endif %}>{% trans %}places.filter_delivery_and_pickup{% endtrans %}</a>
                        <a href="#" data-type="delivery" {% if delivery_type_filer == 'delivery' %}class="selected"{% endif %}>{% trans %}places.filter_delivery{% endtrans %}</a>
                        <a href="#" data-type="pickup" {% if delivery_type_filer == 'pickup' %}class="selected"{% endif %}>{% trans %}places.filter_pickup{% endtrans %}</a>
                    </div>
                    <div class="label">{% trans %}places.order_by{% endtrans %}:</div>
                    <a href="#">{% trans %}places.sort_by_relevance{% endtrans %}</a>
                    <a href="#" class="selected">{% trans %}places.sort_by_rating{% endtrans %}</a>
                    <a href="#">{% trans %}places.sort_by_delivery_price{% endtrans %}</a>
                    <a href="#">{% trans %}places.sort_by_distance{% endtrans %}</a>
                </div>
            </div>#}
            {{ render(controller('FoodPlacesBundle:Default:list', {'recommended': recommended})) }}
        </div>
    </div>

    </div>
    </div>
{% endblock %}

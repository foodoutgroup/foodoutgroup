{# Dispecerinis langas.. OMG, kas per 87 lvl zodziai...#}
{% extends 'SonataAdminBundle:CRUD:base_list.html.twig' %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('bundles/foodapp/js_admin/dispatcher.js') }}"></script>
    <script type="text/javascript">
        $(document).ready(function(){
            Dispatcher.setLocale('{{ app.request.get('_locale') }}');
            Dispatcher.onLoadEvents();

            Dispatcher.setTranslation('change_status_title', '{{ 'admin.dispatcher.order_status_title'|trans({}, 'SonataAdminBundle') }}');
            Dispatcher.setTranslation('button_change', '{{ 'admin.dispatcher.button_change'|trans({}, 'SonataAdminBundle') }}');
            Dispatcher.setTranslation('button_cancel', '{{ 'admin.dispatcher.button_cancel'|trans({}, 'SonataAdminBundle') }}');
        });
    </script>
{% endblock %}

{% block actions %}{% endblock %}

{% block side_menu %}{% endblock %}

{% block list_table %}
    {% macro order_table(order_list) %}
        <div class="driver_button">
            <button class="get_drivers_button btn btn-lg" disabled="disabled">
                {#<span class="icon_steering_wheel"></span>#}
                {{ 'admin.dispatcher.get_drivers'|trans({}, 'SonataAdminBundle') }}
            </button>
        </div>
        <table class="order_list">
            <tr>
                <th></th>
                <th>{{ 'admin.dispatcher.order_id'|trans({}, 'SonataAdminBundle') }}</th>
                <th>{{ 'admin.dispatcher.place'|trans({}, 'SonataAdminBundle') }}</th>
                <th>{{ 'admin.dispatcher.address'|trans({}, 'SonataAdminBundle') }}</th>
                <th>{{ 'admin.dispatcher.client_address'|trans({}, 'SonataAdminBundle') }}</th>
                <th>{{ 'admin.dispatcher.self_delivery'|trans({}, 'SonataAdminBundle') }}</th>
                <th>{{ 'admin.dispatcher.order_date'|trans({}, 'SonataAdminBundle') }}</th>
                <th>{{ 'admin.dispatcher.comment'|trans({}, 'SonataAdminBundle') }}</th>
                <th></th>
            </tr>
            {% for order in order_list %}
                <tr class="{{ loop.index%2 ? 'odd' : 'even' }}">
                    <td>
                        {% if not order.placePointSelfDelivery %}
                            <input type="checkbox" id="order_{{ order.id }}" value="{{ order.id }}" class="order_checkbox" />
                        {% endif %}
                    </td>
                    <td>{{ order.id }}</td>
                    <td>{{ order.placeName }}</td>
                    <td>{{ order.placePoint.address }}</td>
                    <td>{{ order.addressId.address }}</td>
                    <td>
                        {% if order.placePointSelfDelivery %}
                            <span class="glyphicon glyphicon-ok"></span>
                        {% else %}
                            <span class="glyphicon glyphicon-remove"></span>
                        {% endif %}
                    </td>
                    <td>{{ order.orderDate|date("H:i:s") }}</td>
                    <td>
                        {% if order.comment|length > 20 %}
                            <span class="shortened_comment">{{ order.comment|slice(0, 17) }}... <span class="glyphicon glyphicon-question-sign spliced-text" title="{{ order.comment }}"></span></span>
                        {% else %}
                            {{ order.comment }}
                        {% endif %}
                    </td>
                    <td>
                        <button class="btn btn-lg change_status_button" item-id="{{ order.id }}">
                            {{ 'admin.dispatcher.change_status'|trans({}, 'SonataAdminBundle') }}
                        </button>
                        <input type="button" value="test" class="btn btn-lg" disabled="disabled" />
                    </td>
                </tr>
            {% endfor %}
        </table>
    {% endmacro %}
    {% import _self as table %}

    <style type="text/css">div.sidebar.span2 { display: none !important; }</style>
    <div class="city_list todo_nieks_nezino_klases">
        <ul>
            {% for city in cities %}
                <li><a href="#city_list-{{ loop.index }}">{{ city }}</a></li>
            {% endfor %}
        </ul>
        {% for city in cityOrders %}
            <div id="city_list-{{ loop.index }}">
                <ul>
                    <li><a href="#city-{{ loop.index }}-unassigned">{{ 'admin.dispatcher.unassigned'|trans({}, 'SonataAdminBundle') }}</a></li>
                    <li><a href="#city-{{ loop.index }}-undelivered">{{ 'admin.dispatcher.undelivered'|trans({}, 'SonataAdminBundle') }}</a></li>
                </ul>
                <div id="city-{{ loop.index }}-unassigned">
                    {{ table.order_table(city.unassigned) }}
                </div>
                <div id="city-{{ loop.index }}-undelivered">
                    {{ table.order_table(city.not_finished) }}
                </div>
            </div>
            <script type="text/javascript">
                $(document).ready(function(){
                    $('#city_list-{{ loop.index }}').tabs();
                });
            </script>
        {% endfor %}
    </div>
    <div class="drivers_list">
        {# TODO such hack. Wow, drivers. Much respect #}
    </div>
{% endblock %}

{% block list_filters %}
    {# No filter at the moment #}
{% endblock %}
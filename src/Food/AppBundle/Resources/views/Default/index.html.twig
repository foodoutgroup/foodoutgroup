{% extends 'FoodAppBundle::layout.html.twig' %}


    {% block jscode %}
        $(document).ready(function(){
            var tastyCities = {{ render(controller('FoodPlacesBundle:Default:cities')) }};
            $('#index_city').autocomplete({
                source: tastyCities,
                minLength: 0
            });
            var addrXhr = null;
            var addrResponse = {};
            var waitIntervals = null;
            var currentTime = null;


            function getCrds() {
                if (addrXhr != null) {
                    addrXhr.abort();
                }
                addrXhr = $.ajax({
                    type: 'GET',
                    url: '{{ path('food_ajax', {'action': 'find-address'}) }}',
                    data:  {city: $('#index_city').val(), address: $('#index_address').val()},
                    success:  function(resp){
                        if (resp.data.success == 1) {
                            $('.search-food-form').trigger('submit');
                        } else {
                            $('.search-food-form .title').after('<p>' + resp.data.message + '</p>');
                        }
                    }
                });
            }

            $('#index_submit').click(function(e){
                getCrds();
                e.stopPropagation();
                e.preventDefault();
            });

            function waitForState() {
                if (waitIntervals < 20) {
                    if (addrXhr.readyState == 4) {
                        //$('.search-food-form').trigger('submit');
                    } else {
                        waitIntervals++;
                        setTimeout(function() { waitForState(); }, 1000);
                    }
                }
            }
        });
    {% endblock %}


{% block body %}

    <div style="background-image: url({{ asset('bundles/foodapp/images/offer-1.jpg') }});" class="site-header special-offer-block">
        <div class="site-block">
            <h1>Užsisakykite maistą į<br/> namus ar biurą</h1>
            <form class="search-food-form"  action="{{ path('food_places_' ~ locale ~ '_main') }}" method="get">
                <p class="title">Įveskite savo adresą ir sužinokite, kurie restoranai atveš nom nom</p>
                <div class="clearfix">
                    <input type="text" id="index_city" placeholder="{% trans %}index.city{% endtrans %}"  autocomplete="off" >
                    <input type="text" id="index_address" placeholder="{% trans %}index.street{% endtrans %}" class="input-street" autocomplete="off" >
                    <input type="submit" id="index_submit" value="{% trans %}index.findfood{% endtrans %}">
                </div>
            </form>
        </div>
        <p class="img-description">{# pavadinimas produkto, vietove, kaina #}</p>
    </div>
    <div class="site-center">
        <div class="site-block">
            {# TODO kuponu kolkas neturime #}
            {#<div class="items-list-title clearfix">#}
                {#<h2>Geri pasiūlymai</h2><a href="#" class="button">daugiau pasiūlymų</a>#}
            {#</div>#}
            {#<div class="items-list clearfix">#}
                {#<div class="items-list-col"><a href="#" class="cupom-item">#}
                        {#<div class="cupon-top"><img src="{{ asset('bundles/foodapp/images/cupo-1.png') }}">#}
                            {#<p class="cupon-name">Pica už ačiū!</p>#}
                            {#<p class="cupon-desc">Akcija galioja užsisakant dvi ir daugiau picų.</p>#}
                        {#</div>#}
                        {#<div class="cupon-bottom">#}
                            {#<div class="button">Gauk šį pasiūlymą!</div>#}
                        {#</div></a></div>#}
                {#<div class="items-list-col"><a href="#" class="cupom-item">#}
                        {#<div class="cupon-top"><img src="{{ asset('bundles/foodapp/images/cupo-2.png') }}">#}
                            {#<p class="cupon-name">Pica už ačiū!</p>#}
                            {#<p class="cupon-desc">Akcija galioja užsisakant dvi ir daugiau picų.</p>#}
                        {#</div>#}
                        {#<div class="cupon-bottom">#}
                            {#<div class="button">Gauk šį pasiūlymą!</div>#}
                        {#</div></a></div>#}
                {#<div class="items-list-col"><a href="#" class="cupom-item">#}
                        {#<div class="cupon-top"<img src="{{ asset('bundles/foodapp/images/cupo-3.png') }}">#}
                        {#<p class="cupon-name">Pica už ačiū!</p>#}
                        {#<p class="cupon-desc">Akcija galioja užsisakant dvi ir daugiau picų.</p>#}
                {#</div>#}
                {#<div class="cupon-bottom">#}
                    {#<div class="button">Gauk šį pasiūlymą!</div>#}
                {#</div></a>#}
            {#</div>#}
            {#<div class="items-list-col"><a href="#" class="cupom-item">#}
                    {#<div class="cupon-top"><img src="{{ asset('bundles/foodapp/images/cupo-4.png') }}">#}
                        {#<p class="cupon-name">Pica už ačiū!</p>#}
                        {#<p class="cupon-desc">Akcija galioja užsisakant dvi ir daugiau picų.</p>#}
                    {#</div>#}
                    {#<div class="cupon-bottom">#}
                        {#<div class="button">Gauk šį pasiūlymą!</div>#}
                    {#</div></a></div>#}
            {#<div class="items-list-col"><a href="#" class="cupom-item">#}
                    {#<div class="cupon-top"><img src="{{ asset('bundles/foodapp/images/cupo-5.png') }}">#}
                        {#<p class="cupon-name">Pica už ačiū!</p>#}
                        {#<p class="cupon-desc">Akcija galioja užsisakant dvi ir daugiau picų.</p>#}
                    {#</div>#}
                    {#<div class="cupon-bottom">#}
                        {#<div class="button">Gauk šį pasiūlymą!</div>#}
                    {#</div></a></div>#}
        {#</div>#}

        {{ render(controller('FoodPlacesBundle:Default:recommended')) }}

        {% include 'FoodAppBundle:Default:bottom_block.html.twig' %}

        </div>
    </div>
{% endblock %}

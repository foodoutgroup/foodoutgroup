<script>
    if(!window.jQuery)
    {
        var whereToGo = '{{ path('food_slug', {'slug': slug_util.slugByItem(place.id, 'place') })}}#dish{{ dish.id }}';
        window.location.href = whereToGo;
    } else {
        var page = "/lightbox";
        {% if randomizer!=0 %}
            page+="/{{ randomizer }}";
        {% endif %}
        ga('send', 'pageview', page);
        {# Facebook ViewContent Begin #}
        fbq('track', 'ViewContent');
        {# Facebook ViewContent End #}
    }
</script>
<style>
    .name.style0 {
        color: #55422E !important;
    }
    .button-submit.add-to-cart.style0 {
        background-color: #55422e;
        background-repeat: no-repeat;
        background-image: none;
    }
    .name.style1,
    .name.style3,
    .name.style5,
    .name.style7 {
        color: #cd1d36 !important;
    }
    .button-submit.add-to-cart.style1,
    .button-submit.add-to-cart.style3,
    .button-submit.add-to-cart.style5,
    .button-submit.add-to-cart.style7 {
        background-color: #cd1d36;
        background-repeat: no-repeat;
        background-image: none;
    }

    .name.style2,
    .name.style4,
    .name.style6,
    .name.style8 {
        color: #90c200 !important;
    }
    .button-submit.add-to-cart.style2,
    .button-submit.add-to-cart.style4,
    .button-submit.add-to-cart.style6,
    .button-submit.add-to-cart.style8 {
        background-color: #90c200;
        background-repeat: no-repeat;
        background-image: none;
    }

</style>
<div id="detailed-dish-popup">
    <form class="popup detailed-dish-popup">
        {% if dish.getWebPathThumb('type3') is not empty %}
            <img alt="{{ dish.name }}" src="http://{{ cloudfront_url }}/{{ dish.getWebPathThumb('type3') }}" class="popup-header" />
        {% endif %}
        <div class="dish-info">
            <p class="name {% if locale == 'lt' %}style{{ randomizer }}{% endif %}">{{ dish.name }}</p>
            <p class="desc">{{ dish.description|nl2br }}</p>
        </div>
        <div class="dish-size">
            <div class="title">{% trans %}dish.select_size{% endtrans %}</div>
            <div class="clearfix">
                {% for size in dish.sizes %}
                    <label class="custom-radio">{{ size.unit.name }}
                        {% set showDiscount = false %}
                        {% if dish.showDiscount and size.discountPrice != 0 %}
                            {% set showDiscount = true %}
                        {% endif %}
                        {% if dish.showPublicPrice %}
                            {% set zePrice = size.publicPrice %}
                        {% else %}
                            {% set zePrice = size.price %}
                        {% endif %}
                        <strong class="price {% if showDiscount %}discounted{% endif %}">
                            {{ currency_display|raw }}{{ zePrice }}

                            {% if currency_alternative %}
                                <span class="euro">/&nbsp;{{  misc_utils.getLitas(zePrice)|number_format(2, ',', ' ') }}{{ display_currency_alternative }}</span>
                            {% endif %}
                        </strong>
                        {% if showDiscount %}
                            <strong class="price {% if showDiscount %}discount{% endif %}">
                                {{ currency_display|raw }}{{ size.discountPrice }}
                                {% if currency_alternative %}
                                    <span class="euro">/&nbsp;{{  misc_utils.getLitas(size.discountPrice)|number_format(2, ',', ' ') }}{{ display_currency_alternative }}</span>
                                {% endif %}
                            </strong>
                        {% endif %}
                        <input type="radio" {% if loop.index == selectedSize %}checked{% endif %} value="{{ size.id }}" class="dish-size" name="dish-size">
                    </label>
                {% endfor %}
            </div>
        </div>
        {% if dish.options|length > 0 %}
            <div class="dish-ingredients">
                <div class="title">{% trans %}dish.select_options{% endtrans %}</div>
                <div class="clearfix">
                {% set groupName = "" %}
                {% set optCounter = 0 %}
                {% for option in dish.options %}
                    {% if groupName != option.groupName and optCounter != 0 %}
                        <br clear="all" />
                        <br clear="all" />
                    {% endif %}

                    {% set groupName = option.groupName %}
                    {% set optCounter = optCounter+1 %}

                    {% if option.singleSelect == true %}
                        <label class="custom-radio">{{ option.name }}{% if option.price != 0 and dish.showPublicPrice == false %}<strong class="price">+{{ currency_display|raw }}
                                {{ option.priceLocalized }}
                                {% if currency_alternative %}
                                    <span class="euro">/&nbsp;{{  misc_utils.getLitas(option.price)|number_format(2, ',', ' ') }}{{ display_currency_alternative }}</span>
                                {% endif %}

                                </strong>{% endif %}
                            <input type="radio" name="option[{{ option.groupName }}]" value="{{ option.id }}"  {% if cart!=null and option.id in cart.optionsIds %}checked{% endif %}>
                        </label>
                    {% endif %}
                {% endfor %}
                {% for option in dish.options %}
                    {% if option.singleSelect == false %}
                        <label class="custom-checkbox">{{ option.name }}{% if option.price != 0 and dish.showPublicPrice==false %}
                                <strong class="price">+{{ currency_display|raw }} {{ option.priceLocalized }}
                                    {%  if currency_alternative %}<span class="euro">/&nbsp;{{  misc_utils.getLitas(option.price)|number_format(2, ',', ' ') }}{{ display_currency_alternative }}</span>{% endif %}
                                </strong>
                            {% endif %}
                            <input type="checkbox" name="options[]" value="{{ option.id }}"  {% if cart!=null and option.id in cart.optionsIds %}checked{% endif %}>
                        </label>
                    {% endif %}
                {% endfor %}
                </div>
            </div>
        {% endif %}
        <div class="dish-size">
            <div class="title">{% trans %}dish.select_quantity{% endtrans %} <input class="counter" name="counter" value="{% if cart %}{{ cart.quantity }}{% else %}1{% endif %}" /></div>
        </div>
        <input type="hidden" name="place" value="{{ dish.place.id }}" />
        <input type="hidden" name="isAlcohol" value="{% if dish.isAlcohol %}1{% else %}0{% endif %}" />

        <div class="hidden alcoholRules">
            <div>
                {{ dish.place.alcoholRules|nl2br }}
            </div>
        </div>
        {% if locale == "lt" %}
            {% if randomizer != "0" %}
                <div class="dish-info">
                    <p class="name {% if locale == 'lt' %}style{{ randomizer }}{% endif %} message">
                        {{ extraMessages[randomizer].message }}
                    </p>
                </div>
            {% endif %}
        {% endif %}
        <div class="popup-controls"><a href="#" class="button-submit add-to-cart {% if locale == 'lt' %}style{{ randomizer }}{% endif %}"><span>{% trans %}dish.add_to_cart{% endtrans %}</span></a></div>
    </form>
</div>
<script>
    if(!window.jQuery)
    {
        document.getElementById('detailed-dish-popup').setAttribute('style', 'display: none');
    } else {
        {% if  (randomizer == '1' or randomizer == '2') %}
            var countdown =  {{ countdown }};
            var currentcount = {{ currentcount }};
            var someRealCounter = 0;
            var theMessage = '{{ extraMessages[randomizer].message }}';
            setTimeout("recounter()", 1000);
            function recounter()
            {
                currentcount = currentcount + 1;
                var reacounted = countdown - currentcount;
                if (reacounted < 0) {
                    reacounted = 0;
                }
                var mind = reacounted % (60 * 60);
                var minutes = Math.floor(mind / 60);

                var secd = mind % 60;
                var seconds = Math.ceil(secd);
                if (seconds <= 9) {
                    seconds = '0' + seconds;
                }
                theNewMessage = theMessage.replace('{countdown}', minutes + ':' + seconds);
                $('.name.message').text(theNewMessage);
                setTimeout("recounter()", 1000);
            }
        {% endif %}
    }
</script>

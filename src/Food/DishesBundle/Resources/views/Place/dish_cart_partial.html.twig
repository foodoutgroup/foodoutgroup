{% javascripts '@FoodAppBundle/Resources/public/scripts/fancy/jquery.fancybox.pack.js' %}
<script src="{{ asset_url }}"></script>
<script type="application/javascript">
    /**
     * @todo Migrate to JS file
     */
    var addToCartUrl = '{{ path('food_cart_action', {'action' : 'add'}) }}';
    var removeFromCartUrl = '{{ path('food_cart_action', {'action' : 'remove'}) }}';
    var dishBlock = null;
    var dishRemoveBlock = null;
    var bindFancyBox = function() {
        $('.fancy-box').fancybox({
            padding : 0,
            scrolling: 'visible',
            afterShow: function(e) {
                dishBlock = $('#detailed-dish-popup');
                dishBlock.find('input').iCheck();
                dishBlock.find('.counter').foodCounter(0, 50, 1);
                dishBlock.find('.button-submit.add-to-cart:not(.has-bind)').addClass('has-bind').bind('click', function() {
                    addToCart();
                });
                var inputs = $('.dish-ingredients').find('input[type="radio"]');
                var groupNames = [];
                var groupElements = [];
                for (i = 0; i < inputs.length; i++) {
                    var inp = $(inputs[i]);
                    inp.attr('selected', null);
                    inp.closest('.iradio').removeClass('checked');
                    var name = inp.attr('name');
                    name = name.replace("option[", "").replace("]", "");
                    if (groupNames.indexOf(name) == -1) {
                        groupNames.push(name);
                        groupElements.push(inp);
                    }
                }
                for(i = 0; i < groupElements.length; i++) {
                    groupElements[i].attr('checked', 'checked');
                    groupElements[i].closest('.iradio').addClass('checked');
                }
            }
        });
        $('.fancy-box.remove').fancybox({
            padding : 0,
            scrolling: 'visible',
            afterShow: function(e) {
                dishRemoveBlock = $('#detailed-dish-popup-remove');
                dishRemoveBlock.find('.remove-from-cart:not(.has-bind)').addClass('has-bind').bind('click', function() {
                    removeFromCart();
                });
            }
        });
    };

    $(document).ready(function(){
        bindFancyBox();
    });

    function removeFromCart()
    {
        dishRemoveBlock.mask();
        $.post(removeFromCartUrl, dishRemoveBlock.find('form').serialize(), function(resp) {
            if (typeof(resp.block) != "undefined") {
                $('.check-block').replaceWith(resp.block);
            }
            dishRemoveBlock.unmask();
            $.fancybox.close();
        }, 'json');
    }

    function addToCart() {
        if (dishBlock.find('.dish-size:checked').length != 0) {
            dishBlock.mask();
            $.post(addToCartUrl, $('.popup.detailed-dish-popup').serialize(), function(resp) {
                if (typeof(resp.block) != "undefined") {
                    $('.check-block').replaceWith(resp.block);
                }
                dishBlock.unmask();
                $.fancybox.close();
            }, 'json');
        }
    }
</script>
{% endjavascripts %}

    {% javascripts '@FoodAppBundle/Resources/public/scripts/fancy/helpers/jquery.fancybox-media.js' %}
<script src="{{ asset_url }}"></script>
{% endjavascripts %}

    {% stylesheets '@FoodAppBundle/Resources/public/scripts/fancy/jquery.fancybox.css' %}
<link rel="stylesheet" href="{{ asset_url }}" type="text/css"  />
{% endstylesheets %}